syntax = "proto3";
package user;
option go_package = "go-grst-boilerplate/handler/grpc/user";

import "google/protobuf/empty.proto";

service UserApi {
    // Public endpoint - no auth required
    rpc Register(RegisterReq) returns (RegisterRes);

    // Public endpoint - no auth required
    rpc Login(LoginReq) returns (LoginRes);

    // Protected endpoint - requires valid token
    rpc RefreshToken(RefreshTokenReq) returns (RefreshTokenRes);

    // Protected endpoint - requires authentication
    rpc GetMe(google.protobuf.Empty) returns (UserProfile);

    // Protected endpoint - invalidates session
    rpc Logout(google.protobuf.Empty) returns (LogoutRes);

    // Admin endpoint - list all users
    rpc ListUsers(ListUsersReq) returns (ListUsersRes);

    // Admin endpoint - get user by ID
    rpc GetUser(GetUserReq) returns (UserProfile);

    // Admin endpoint - update user by ID
    rpc UpdateUser(UpdateUserReq) returns (UserProfile);

    // Admin endpoint - soft-delete user
    rpc DeleteUser(DeleteUserReq) returns (DeleteUserRes);
}

message RegisterReq {
    string email = 1 [json_name = "email"];
    string password = 2 [json_name = "password"];
    string name = 3 [json_name = "name"];
    string phone = 4 [json_name = "phone"];
}

message RegisterRes {
    string id = 1 [json_name = "id"];
    string email = 2 [json_name = "email"];
    string name = 3 [json_name = "name"];
}

message LoginReq {
    string email = 1 [json_name = "email"];
    string password = 2 [json_name = "password"];
}

message LoginRes {
    string token = 1 [json_name = "token"];
    UserProfile user = 2 [json_name = "user"];
}

message RefreshTokenReq {
    string token = 1 [json_name = "token"];
}

message RefreshTokenRes {
    string token = 1 [json_name = "token"];
}

message LogoutRes {
    string message = 1 [json_name = "message"];
}

message UserProfile {
    string id = 1 [json_name = "id"];
    string email = 2 [json_name = "email"];
    string name = 3 [json_name = "name"];
    string phone = 4 [json_name = "phone"];
    string status = 5 [json_name = "status"];
    string created_at = 6 [json_name = "createdAt"];
}

message ListUsersReq {
    int32 page = 1 [json_name = "page"];
    int32 size = 2 [json_name = "size"];
    string search = 3 [json_name = "search"];
    string sort_by = 4 [json_name = "sortBy"];
    string sort_order = 5 [json_name = "sortOrder"];
}

message ListUsersRes {
    repeated UserProfile users = 1 [json_name = "users"];
    Pagination pagination = 2 [json_name = "pagination"];
}

message Pagination {
    int32 page = 1 [json_name = "page"];
    int32 size = 2 [json_name = "size"];
    int64 total = 3 [json_name = "total"];
    int32 total_pages = 4 [json_name = "totalPages"];
}

message GetUserReq {
    string id = 1 [json_name = "id"];
}

message UpdateUserReq {
    string id = 1 [json_name = "id"];
    string name = 2 [json_name = "name"];
    string phone = 3 [json_name = "phone"];
    string status = 4 [json_name = "status"];
}

message DeleteUserReq {
    string id = 1 [json_name = "id"];
}

message DeleteUserRes {
    string message = 1 [json_name = "message"];
}
